<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024px, initial-scale=1.0">
    <title>index</title>
    <link rel="stylesheet" href="css/index.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400&display=swap" rel="stylesheet">
    <script src="js/jquery-3.5.1.js"></script>
</head>
<body>
    <header>
        <div class="menu">
            <ul>
                <li><a href="index.html">홈</a></li>
                <li><a href="introduce.html">자기소개</a></li>
                <li><a href="interest.html">관심사</a></li>
                <li><a href="devroadmap.html">개발자 로드맵</a></li>
                <!-- <li><a href="signup.html">회원가입</a></li> -->
            </ul>
        </div>
    </header>
    <hr width="80%">
    
    <section class="main">
        <div class="login">
            <label for="userId">아이디</label>
            <input type="text" name="userId" id="userIdLogin">
            <label for="pwd">비밀번호</label>
            <input type="password" name="pwd" id="pwdLogin">
            <input type="submit" value="로그인" style="width: 55px;" onclick="userInfo();">
        </div>
            <a href="#layer2" class="btn-example"><button>회원가입</button></a>
        <form action="javascript:validate();">
        <div class="dim-layer">
            <div class="dimBg"></div>
            <div id="layer2" class="pop-layer">
                <div class="pop-container">
                    <div class="pop-conts">
                        <!--content //-->
                            <table>
                                <tr>
                                    <td><label for="userId">아이디<span class="req">*</span></label></td>
                                    <td><input type="text" name="userId" id="userId" required></td>
                                </tr>
                                <tr>
                                    <td><label for="pwd">비밀번호<span class="req">*</span></label></td>
                                    <td><input type="password" name="pwd" id="pwd" required></td>
                                </tr>
                                <p id="p-pwd">숫자+영문자+특수문자 조합으로 8자리 이상</p>
                                <tr>
                                    <td><label for="pwdCheck">비밀번호 확인<span class="req">*</span></label></td>
                                    <td><input type="password" name="pwdCheck" id="pwdCheck" required></td>
                                    <p id="p-pwdCheck">비밀번호 불일치</p>
                                </tr>
                                <tr>
                                    <td><label for="userName">이름</label></td>
                                    <td><input type="text" name="userName" id="userName"></td>
                                </tr>
                                <tr>
                                    <td><label for="birth">생년월일</label></td>
                                    <td><input type="hidden" name="userBirth">
                                        <select id="year">
                                            <option>년도</option>
                                        </select>
                                        <select id="month">
                                            <option>월</option>
                                        </select>
                                        <select id="day"><option>일</option></select></td>
                                </tr>
                                <tr>
                                    <td><label for="gender">성별</label></td>
                                    <td>
                                        <label for="male">남</label>
                                        <input type="radio" name="gender" id="male" value="M" checked>
                                        <label for="female">여</label>
                                        <input type="radio" name="gender" id="female" value="F">
                                    </td>
                                </tr>
                                <tr>
                                    <td><label for="phone">휴대전화</label></td>
                                    <td>
                                        <input type="hidden" name="phone">
                                                <select id="phoneF">
                                                    <option value="010">010</option>
                                                    <option value="011">011</option>
                                                    <option value="016">016</option>
                                                    <option value="017">017</option>
                                                    <option value="018">018</option>
                                                    <option value="019">019</option>
                                                </select><span id="sp1"> -</span>
                                        <input type="text" name="phoneM" id="phoneM"><span id="sp2"> -</span> 
                                        <input type="text" name="phoneL" id="phoneL">
                                        <p id="p-phone">숫자만 입력하세요</p>
                                    </td>
                                </tr>
                                <!-- <tr>
                                    <td colspan="2"><input type="submit" value="완료" id="sub"></td>
                                </tr> -->
                            </table>
                            <div class="btn-r">
                                <input type="submit" value="완료" id="sub">
                                <a href="#" class="btn-layerClose">Close</a>
                            </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <!-- <a href="signup.html" id="signup">회원가입</a> -->
        <div>
            <!-- <hr width="80%"> -->
            <img src="images/main2.png" alt="" class="text-focus-in">
        </div>
    </section>
    <script>
        $('#pwdCheck').focusout(function () {
            var pwd = document.getElementById("pwd");
            var pwdcheck = document.getElementById("pwdcheck");
            
            if(pwd.value == pwdCheck.value){
                $('#p-pwdCheck').css('opacity', '0');
                return true;
            }
            else{
                $('#p-pwdCheck').css('opacity', '1');
                // alert("비밀번호가 일치하지 않습니다.");
                // pwd.select();
                return false;
            }
        });
        $('#pwd').focusout(function () {
            if(!/^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/.test(pwd.value)){ 
                $('#p-pwd').css('opacity', '1');
                // alert('숫자+영문자+특수문자 조합으로 8자리 이상 사용해야 합니다.');
                $('#pwd').val('').focus();
                return false;
            }
            else
                $('#p-pwd').css('opacity', '0');

        });
        $('#phoneM').focusout(function () {
            if(phoneM.value != '') {
                if(!/^[0-9]{3,4}$/.test(phoneM.value)) {
                    $('#p-phone').css('opacity', '1');
                    $('#phoneM').val('').focus;
                    // alert('숫자만 입력하세요');
                    return false;
                }
                else
                    $('#p-phone').css('opacity', '0');
            }
            $('#p-phone').css('opacity', '0');

        });
        $('#phoneL').focusout(function () {
            if(phoneL.value != '') {
                if(!/^[0-9]{3,4}$/.test(phoneL.value)) {
                    $('#p-phone').css('opacity', '1');
                    $('#phoneL').val('').focus;
                    // alert('숫자만 입력하세요');
                    return false;
                }
                else
                    $('#p-phone').css('opacity', '0');

            }
            $('#p-phone').css('opacity', '0');

        });

        function saveEntry() {
            let entry = {
                userId: $("#userId").val(),
                pwd: $("#pwd").val()
            }
            console.log(entry);

            let userInfo = JSON.parse(localStorage.getItem("userInfo"));//불러오기(데이터누적)
            if(userInfo == null)
                userInfo = [];

            userInfo.push(entry);
            
            localStorage.setItem("userInfo", JSON.stringify(userInfo));
        }
        function userInfo() {
            let userInfo = JSON.parse(localStorage.getItem("userInfo"));
            $(userInfo).each(function(i, entry) {
                let $userIdLogin= $("#userIdLogin").val();
                let $pwdLogin= $("#pwdLogin").val();
                if(entry.userId == $userIdLogin) {
                    if(entry.pwd == $pwdLogin){
                        alert("로그인성공");
                        $("#userIdLogin, #pwdLogin").val('');
                        return false;
                    }
                    else {
                        alert("비밀번호를 확인해주세요");
                    }
                    return false;
                }
                else {
                    alert("회원가입을 먼저 진행해주세요");
                }
            })
        }

        function validate() {
            var userId = document.getElementById("userId");
            var pwd = document.getElementById("pwd");
            var pwdCheck = document.getElementById("pwdCheck");
            var userName = document.getElementById("userName");
            var phoneM = document.getElementById("phoneM");
            var phoneL = document.getElementById("phoneL");

            if(!/^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/.test(pwd.value)){ 
                $('#p-pwd').css('opacity', '1');
                // alert('숫자+영문자+특수문자 조합으로 8자리 이상 사용해야 합니다.');
                $('#pwd').val('').focus();
                $('#pwdCheck').val('').focus();
                return false;
            }  
            $('#p-pwd').css('opacity', '0');
            // 비밀번호일치여부
            if(!isEqualPwd()){
                return false;
            }
            $('#p-pwdCheck').css('opacity', '0');
            //폰번호 숫자만
            if(phoneM.value != '' && phoneL.value != '') {
                if(!/^[0-9]{3,4}$/.test(phoneM.value) || !/^[0-9]{4}$/.test(phoneL.value)) {
                    $('#p-phone').css('opacity', '1');
                    // $('#p-phone').show();
                    $('#phoneM').val('').focus;
                    $('#phoneL').val('').focus;
                    // alert('숫자만 입력하세요');
                    return false;
                }
            }
            $('#p-phone').css('opacity', '0');
            
            saveEntry();
            $("#userId,#pwd,#pwdCheck,#userName,#phoneM,#phoneL").val('');
            alert("회원 가입 성공!");
            return true;
        }
        function isEqualPwd(){
            var pwd = document.getElementById("pwd");
            var pwdcheck = document.getElementById("pwdcheck");
            
            if(pwd.value == pwdCheck.value){
                $('#p-pwdCheck').css('opacity', '0');
                return true;
            }
            else{
                $('#p-pwdCheck').css('opacity', '1');
                // alert("비밀번호가 일치하지 않습니다.");
                // pwd.select();
                return false;
            }
        }

        $('.btn-example').click(function(){
            var $href = $(this).attr('href');
            layer_popup($href);
        });
        function layer_popup(el){

        var $el = $(el);        //레이어의 id를 $el 변수에 저장
        var isDim = $el.prev().hasClass('dimBg');   //dimmed 레이어를 감지하기 위한 boolean 변수

        isDim ? $('.dim-layer').fadeIn() : $el.fadeIn();

        var $elWidth = ~~($el.outerWidth()),
            $elHeight = ~~($el.outerHeight()),
            docWidth = $(document).width(),
            docHeight = $(document).height();

        // 화면의 중앙에 레이어를 띄운다.
        if ($elHeight < docHeight || $elWidth < docWidth) {
            $el.css({
                marginTop: -$elHeight /2,
                marginLeft: -$elWidth/2
            })
        } else {
            $el.css({top: 0, left: 0});
        }

        $el.find('a.btn-layerClose').click(function(){
            isDim ? $('.dim-layer').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.
            return false;
        });

        $('.layer .dimBg').click(function(){
            $('.dim-layer').fadeOut();
            return false;
        });
        $(document).ready(function(){
        setDateBox();
        });    

        // select box 연도 , 월 표시
        function setDateBox(){
        var dt = new Date();
        var year = "";
        var com_year = dt.getFullYear();
        // 년도 뿌려주기
        for(var y = (com_year-100); y <=com_year; y++){
            $("#year").append("<option value='"+ y +"'>"+ y + " 년" +"</option>");
        }
        // 월 뿌려주기(1월부터 12월)
        var month;
        for(var i = 1; i <= 12; i++){
            $("#month").append("<option value='"+ i +"'>"+ i + " 월" +"</option>");
        }
        let day;
        for(var i = 1; i <= 31; i++){
            $("#day").append("<option value='"+ i +"'>"+ i + " 일" +"</option>");
        }
    }
    }
    </script>
</body>
</html>